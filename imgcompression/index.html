<!--
 * @Author: PiPi
 * @Email: pisenliang@gmail.com
 * @Github: https://github.com/SenLiangpi
 * @Website: https://senliangpi.github.io/blog/#/
 * @Date: 2020-07-31 15:53:00
 * @LastEditors: Pi Patle
 * @LastEditTime: 2022-03-03 15:14:20
--> 

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>图片压缩
  </title>
  <style>
  </style>
</head>

<body>
  <input id="fileId1" type="file" name="file" multiple="multiple" onchange="file1(this)" />
  <img id="pression" />
</body>
<script src="../js/model.umd.min.js"></script>
<script>
  function getObjectURL(file) {
    var url = null;
    if (window.createObjcectURL != undefined) {
      url = window.createOjcectURL(file);
    } else if (window.URL != undefined) {
      url = window.URL.createObjectURL(file);
    } else if (window.webkitURL != undefined) {
      url = window.webkitURL.createObjectURL(file);
    }
    return url;
  }
  let dom = document.getElementById('pression');
  // let Imgwidth,imgHeight;
  function file1(e){
    for(let a in e.files){
      pictureCompression(e.files[a],1920).then((result) => {
        dom.src = getObjectURL(result);
      }).catch((err) => {
      });
      
      // var url = getObjectURL(e.files[a]);
      // var newImg=new Image();
      // newImg.src=url
      // newImg.onload = function(){
      //   imgcompression(url, newImg.width, newImg.height)
      // };
    }
  }
    
  // }
  // let dom = document.getElementById('pression');
  // function imgcompression(url, width, height){
  //   let proportion;
  //   if(width > 1080 || height > 1080){
  //     if(width > height){
  //       proportion = width/1080
  //     }else{
  //       proportion = height/1080
  //     }
  //     var canvasDom = document.createElement('canvas');
  //     canvasDom.width = width/proportion;
  //     canvasDom.height = height/proportion;
  //     // dom.appendChild(canvasDom)
  //     var ctx = canvasDom.getContext("2d");
  //     var img = new Image();
  //     //需要平铺的图片
  //     img.src = url;
  //     img.onload = function (){
  //       ctx.width = canvasDom.width;
  //       ctx.height = canvasDom.height;
  //       ctx.drawImage(this, 0, 0, ctx.width, ctx.height);
  //       let newImages = new Image();
  //       newImages.src=canvasDom.toDataURL("image/jpeg",0.9)
  //       dom.appendChild(newImages)
  //     }
  //   }
  // }
  // let dom = document.getElementById('aaa');
  // var canvasDom = document.createElement('canvas');
  // canvasDom.width = dom.clientWidth;
  // canvasDom.height = dom.clientHeight;
  // dom.appendChild(canvasDom)
</script>

</html>