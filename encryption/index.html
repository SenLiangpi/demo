<!--
 * @Author: Pi Patle
 * @Email: pisenliang@gmail.com
 * @Github: https://github.com/SenLiangpi
 * @Date: 2025-12-24
 * @LastEditors: Pi Patle
 * @LastEditTime: 2025-12-24
-->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ä¸“ä¸šåŠ å¯†å·¥å…· - Professional Encryption Tool</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px 0;
    }

    .container-main {
      max-width: 1000px;
      margin: 50px auto;
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .subtitle {
      text-align: center;
      color: #999;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .form-control {
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      transition: all 0.3s;
    }

    .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    textarea.form-control {
      min-height: 150px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }

    .btn-custom {
      border-radius: 8px;
      padding: 10px 30px;
      font-weight: bold;
      transition: all 0.3s;
      margin: 5px;
    }

    .btn-encrypt {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
    }

    .btn-encrypt:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-decrypt {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border: none;
      color: white;
    }

    .btn-decrypt:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
    }

    .btn-copy {
      background: #28a745;
      border: none;
      color: white;
    }

    .btn-copy:hover {
      background: #218838;
      transform: translateY(-2px);
    }

    .btn-clear {
      background: #6c757d;
      border: none;
      color: white;
    }

    .btn-clear:hover {
      background: #5a6268;
    }

    .result-section {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .result-label {
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }

    .result-text {
      background: white;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      word-break: break-all;
      min-height: 100px;
      border: 1px solid #ddd;
    }

    .algorithm-info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 13px;
      color: #1976d2;
    }

    .algorithm-info strong {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .button-group {
      text-align: center;
      margin-top: 20px;
    }

    .alert-custom {
      border-radius: 8px;
      margin-top: 20px;
    }

    .tab-content {
      margin-top: 20px;
    }

    .nav-tabs > li.active > a {
      background: #667eea !important;
      color: white !important;
      border-color: #667eea !important;
    }

    .nav-tabs > li > a {
      border-radius: 8px 8px 0 0;
      margin-right: 5px;
    }

    .file-upload-area {
      border: 3px dashed #667eea;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      background: #f8f9fa;
      cursor: pointer;
      transition: all 0.3s;
    }

    .file-upload-area:hover {
      background: #e7f1ff;
      border-color: #5568d3;
    }

    .file-upload-area.drag-over {
      background: #d4e5ff;
      border-color: #4557c2;
    }

    .file-info {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border: 1px solid #ddd;
    }

    .file-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .key-strength-meter {
      margin-top: 8px;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .key-strength-bar {
      height: 100%;
      transition: all 0.3s;
      border-radius: 4px;
    }

    .strength-weak { background: linear-gradient(90deg, #ff4444, #ff6666); width: 25%; }
    .strength-medium { background: linear-gradient(90deg, #ff9800, #ffb74d); width: 50%; }
    .strength-good { background: linear-gradient(90deg, #2196f3, #64b5f6); width: 75%; }
    .strength-strong { background: linear-gradient(90deg, #4caf50, #81c784); width: 100%; }

    .key-strength-info {
      margin-top: 10px;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      display: none;
    }

    .strength-info-weak {
      background: #ffebee;
      border: 1px solid #ffcdd2;
      color: #c62828;
    }

    .strength-info-medium {
      background: #fff3e0;
      border: 1px solid #ffe0b2;
      color: #e65100;
    }

    .strength-info-good {
      background: #e3f2fd;
      border: 1px solid #bbdefb;
      color: #1565c0;
    }

    .strength-info-strong {
      background: #e8f5e9;
      border: 1px solid #c8e6c9;
      color: #2e7d32;
    }

    .crack-time {
      font-weight: bold;
      font-size: 14px;
      margin: 8px 0;
    }
  </style>
</head>

<body>
  <div class="container-main">
    <h1>ğŸ” ä¸“ä¸šåŠ å¯†å·¥å…·</h1>
    <p class="subtitle">Professional Encryption Tool - AES å†›äº‹çº§åŠ å¯†</p>

    <!-- Tab å¯¼èˆª -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active">
        <a href="#textTab" aria-controls="textTab" role="tab" data-toggle="tab">ğŸ“ æ–‡æœ¬åŠ å¯†</a>
      </li>
      <li role="presentation">
        <a href="#fileTab" aria-controls="fileTab" role="tab" data-toggle="tab">ğŸ“ æ–‡ä»¶åŠ å¯†</a>
      </li>
    </ul>

    <!-- Tab å†…å®¹ -->
    <div class="tab-content">
      <!-- æ–‡æœ¬åŠ å¯† Tab -->
      <div role="tabpanel" class="tab-pane active" id="textTab">
        <div class="row" style="margin-top: 20px;">
          <div class="col-md-12">
            <div class="form-group">
              <label for="algorithm">åŠ å¯†ç®—æ³• (Encryption Algorithm)</label>
              <select class="form-control" id="algorithm">
                <option value="aes-256" selected>AES-256-CBC (æ¨è - å†›äº‹çº§åŠ å¯†)</option>
                <option value="aes-192">AES-192-CBC (é«˜å¼ºåº¦åŠ å¯†)</option>
                <option value="aes-128">AES-128-CTR (æ ‡å‡†åŠ å¯†)</option>
              </select>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label for="secretKey">å¯†é’¥ (Secret Key) <span class="text-danger">*å¿…å¡«</span></label>
              <input type="password" class="form-control" id="secretKey" placeholder="è¯·è¾“å…¥å¼ºå¯†é’¥ï¼ˆå»ºè®®16ä½ä»¥ä¸Šï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼‰">
              <div class="key-strength-meter">
                <div class="key-strength-bar" id="keyStrengthBar"></div>
              </div>
              <div class="key-strength-info" id="keyStrengthInfo"></div>
              <small class="text-muted">ğŸ’¡ æç¤ºï¼šå¯†é’¥è¶Šå¤æ‚è¶Šå®‰å…¨ï¼ŒåŠ¡å¿…å¦¥å–„ä¿ç®¡å¯†é’¥</small>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label for="inputText">è¾“å…¥æ–‡æœ¬ (Input Text)</label>
              <textarea class="form-control" id="inputText" placeholder="è¯·è¾“å…¥éœ€è¦åŠ å¯†çš„æ–‡æœ¬å†…å®¹..."></textarea>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button type="button" class="btn btn-custom btn-encrypt" id="encryptBtn">
            ğŸ”’ åŠ å¯† (Encrypt)
          </button>
          <button type="button" class="btn btn-custom btn-decrypt" id="decryptBtn">
            ğŸ”“ è§£å¯† (Decrypt)
          </button>
          <button type="button" class="btn btn-custom btn-copy" id="copyBtn">
            ğŸ“‹ å¤åˆ¶ç»“æœ (Copy)
          </button>
          <button type="button" class="btn btn-custom btn-clear" id="clearBtn">
            ğŸ—‘ï¸ æ¸…ç©º (Clear)
          </button>
        </div>

        <div class="result-section" id="resultSection" style="display:none;">
          <div class="result-label">å¤„ç†ç»“æœ (Result):</div>
          <div class="result-text" id="resultText"></div>
        </div>
      </div>

      <!-- æ–‡ä»¶åŠ å¯† Tab -->
      <div role="tabpanel" class="tab-pane" id="fileTab">
        <div class="row" style="margin-top: 20px;">
          <div class="col-md-12">
            <div class="form-group">
              <label for="fileAlgorithm">åŠ å¯†ç®—æ³• (Encryption Algorithm)</label>
              <select class="form-control" id="fileAlgorithm">
                <option value="aes-256" selected>AES-256-CBC (æ¨è)</option>
                <option value="aes-192">AES-192-CBC</option>
                <option value="aes-128">AES-128-CTR</option>
              </select>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label for="fileSecretKey">å¯†é’¥ (Secret Key) <span class="text-danger">*å¿…å¡«</span></label>
              <input type="password" class="form-control" id="fileSecretKey" placeholder="è¯·è¾“å…¥å¼ºå¯†é’¥">
              <div class="key-strength-meter">
                <div class="key-strength-bar" id="fileKeyStrengthBar"></div>
              </div>
              <div class="key-strength-info" id="fileKeyStrengthInfo"></div>
              <small class="text-muted">âš ï¸ è§£å¯†æ—¶å¿…é¡»ä½¿ç”¨ç›¸åŒå¯†é’¥</small>
            </div>
          </div>

          <div class="col-md-12">
            <input type="file" id="fileInput" style="display:none;" accept=".md,.txt,.encrypted">
            <div class="file-upload-area" id="fileUploadArea">
              <div class="file-icon">ğŸ“„</div>
              <h4>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©</h4>
              <p class="text-muted">æ”¯æŒ .md, .txt ç­‰æ–‡æœ¬æ–‡ä»¶</p>
            </div>
            <div class="file-info" id="fileInfo" style="display:none;">
              <strong>æ–‡ä»¶ä¿¡æ¯:</strong>
              <div id="fileDetails"></div>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button type="button" class="btn btn-custom btn-encrypt" id="encryptFileBtn">
            ğŸ”’ åŠ å¯†æ–‡ä»¶ (Encrypt File)
          </button>
          <button type="button" class="btn btn-custom btn-decrypt" id="decryptFileBtn">
            ğŸ”“ è§£å¯†æ–‡ä»¶ (Decrypt File)
          </button>
          <button type="button" class="btn btn-custom btn-clear" id="clearFileBtn">
            ğŸ—‘ï¸ æ¸…ç©º (Clear)
          </button>
        </div>
      </div>
    </div>

    <div class="algorithm-info">
      <strong id="algoTitle">AES-256-CBC åŠ å¯†ç®—æ³• + PBKDF2</strong>
      <div id="algoDescription">
        AES-256-CBC é‡‡ç”¨256ä½å¯†é’¥å’Œå¯†ç å—é“¾æ¥æ¨¡å¼ï¼Œç»“åˆPBKDF2å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆ10000æ¬¡è¿­ä»£ï¼‰å’ŒéšæœºIV/Saltï¼Œæä¾›å†›äº‹çº§å®‰å…¨ä¿æŠ¤ï¼Œå¹¿æ³›åº”ç”¨äºé‡‘èã€å†›äº‹ç­‰é«˜å®‰å…¨åœºæ™¯ã€‚
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <script>
    // ç®—æ³•æè¿°ä¿¡æ¯
    const algoInfo = {
      'aes-256': {
        title: 'AES-256-CBC åŠ å¯†ç®—æ³• + PBKDF2',
        description: 'AES-256-CBC é‡‡ç”¨256ä½å¯†é’¥å’Œå¯†ç å—é“¾æ¥æ¨¡å¼ï¼Œç»“åˆPBKDF2å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆ10000æ¬¡è¿­ä»£ï¼‰å’ŒéšæœºIV/Saltï¼Œæä¾›å†›äº‹çº§å®‰å…¨ä¿æŠ¤ï¼Œå¹¿æ³›åº”ç”¨äºé‡‘èã€å†›äº‹ç­‰é«˜å®‰å…¨åœºæ™¯ã€‚'
      },
      'aes-192': {
        title: 'AES-192-CBC åŠ å¯†ç®—æ³•',
        description: 'AES-192-CBC ä½¿ç”¨192ä½å¯†é’¥å’Œå¯†ç å—é“¾æ¥æ¨¡å¼ï¼Œæä¾›é«˜å¼ºåº¦åŠ å¯†ï¼Œé€‚ç”¨äºä¼ä¸šçº§æ•°æ®ä¿æŠ¤ã€‚'
      },
      'aes-128': {
        title: 'AES-128-CTR åŠ å¯†ç®—æ³•',
        description: 'AES-128-CTR ä½¿ç”¨128ä½å¯†é’¥å’Œè®¡æ•°å™¨æ¨¡å¼ï¼ŒåŠ å¯†é€Ÿåº¦å¿«ï¼Œå®‰å…¨æ€§é«˜ï¼Œé€‚åˆå¤§é‡æ•°æ®åŠ å¯†ã€‚'
      }
    };

    let currentFile = null;
    let currentFileContent = null;

    // å¯†é’¥å¼ºåº¦æ£€æµ‹å‡½æ•°
    function checkKeyStrength(key) {
      if (!key) return { strength: 'none', level: 0 };
      
      let score = 0;
      let details = {
        length: key.length,
        hasLower: /[a-z]/.test(key),
        hasUpper: /[A-Z]/.test(key),
        hasNumber: /[0-9]/.test(key),
        hasSpecial: /[^a-zA-Z0-9]/.test(key)
      };
      
      // é•¿åº¦è¯„åˆ†
      if (details.length >= 32) score += 40;
      else if (details.length >= 24) score += 35;
      else if (details.length >= 16) score += 25;
      else if (details.length >= 12) score += 15;
      else if (details.length >= 8) score += 10;
      else score += 5;
      
      // å­—ç¬¦ç±»å‹è¯„åˆ†
      if (details.hasLower) score += 10;
      if (details.hasUpper) score += 10;
      if (details.hasNumber) score += 15;
      if (details.hasSpecial) score += 25;
      
      // è®¡ç®—å¯èƒ½çš„ç»„åˆç©ºé—´ï¼ˆä½æ•°ï¼‰
      let charSpace = 0;
      if (details.hasLower) charSpace += 26;
      if (details.hasUpper) charSpace += 26;
      if (details.hasNumber) charSpace += 10;
      if (details.hasSpecial) charSpace += 32;
      
      // è®¡ç®—æ€»å¯èƒ½æ€§ï¼ˆå¯¹æ•°å½¢å¼é¿å…æº¢å‡ºï¼‰
      const entropy = details.length * Math.log2(charSpace);
      
      // ä¼°ç®—ç ´è§£æ—¶é—´ï¼ˆå‡è®¾æ¯ç§’100äº¿æ¬¡å°è¯•ï¼‰
      const combinations = Math.pow(2, entropy);
      const secondsToBreak = combinations / 10000000000; // 100äº¿æ¬¡/ç§’
      
      let timeStr = '';
      if (secondsToBreak < 60) {
        timeStr = 'ä¸åˆ°1åˆ†é’Ÿ';
      } else if (secondsToBreak < 3600) {
        timeStr = Math.round(secondsToBreak / 60) + 'åˆ†é’Ÿ';
      } else if (secondsToBreak < 86400) {
        timeStr = Math.round(secondsToBreak / 3600) + 'å°æ—¶';
      } else if (secondsToBreak < 31536000) {
        timeStr = Math.round(secondsToBreak / 86400) + 'å¤©';
      } else if (secondsToBreak < 31536000000) {
        timeStr = Math.round(secondsToBreak / 31536000) + 'å¹´';
      } else if (secondsToBreak < 31536000000000) {
        timeStr = Math.round(secondsToBreak / 31536000000) + 'åƒå¹´';
      } else if (secondsToBreak < 31536000000000000) {
        timeStr = Math.round(secondsToBreak / 31536000000000) + 'ç™¾ä¸‡å¹´';
      } else {
        const universeAge = secondsToBreak / (13.8 * 1000000000 * 31536000);
        if (universeAge > 1000000000000) {
          timeStr = 'äº‹å®ä¸Šä¸å¯èƒ½ç ´è§£ï¼ˆéœ€è¦å®‡å®™å¹´é¾„çš„æ•°ä¸‡äº¿å€æ—¶é—´ï¼‰';
        } else if (universeAge > 1000000) {
          timeStr = universeAge.toExponential(2) + ' å€å®‡å®™å¹´é¾„';
        } else {
          timeStr = Math.round(universeAge) + ' å€å®‡å®™å¹´é¾„';
        }
      }
      
      let strength, level, message, recommendation;
      
      if (score < 30) {
        strength = 'weak';
        level = 1;
        message = 'âš ï¸ å¯†é’¥å¼ºåº¦ï¼šæå¼±';
        recommendation = 'å»ºè®®å¢åŠ é•¿åº¦åˆ°16ä½ä»¥ä¸Šï¼Œå¹¶åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦';
      } else if (score < 50) {
        strength = 'medium';
        level = 2;
        message = 'âš¡ å¯†é’¥å¼ºåº¦ï¼šä¸­ç­‰';
        recommendation = 'å»ºè®®å¢åŠ åˆ°24ä½ä»¥ä¸Šï¼Œå¹¶ç¡®ä¿åŒ…å«æ‰€æœ‰ç±»å‹å­—ç¬¦ä»¥æé«˜å®‰å…¨æ€§';
      } else if (score < 75) {
        strength = 'good';
        level = 3;
        message = 'âœ… å¯†é’¥å¼ºåº¦ï¼šè‰¯å¥½';
        recommendation = 'è¾¾åˆ°åŸºæœ¬å®‰å…¨è¦æ±‚ï¼Œå»ºè®®å¢åŠ åˆ°32ä½ä»¥è·å¾—æ›´é«˜å®‰å…¨æ€§';
      } else {
        strength = 'strong';
        level = 4;
        message = 'ğŸ›¡ï¸ å¯†é’¥å¼ºåº¦ï¼šæå¼º';
        recommendation = 'ä¼˜ç§€ï¼è¿™æ˜¯å†›äº‹çº§å®‰å…¨å¼ºåº¦ï¼Œè¶³ä»¥ä¿æŠ¤é«˜åº¦æ•æ„Ÿä¿¡æ¯';
      }
      
      return {
        strength,
        level,
        score,
        message,
        recommendation,
        timeStr,
        entropy: Math.round(entropy),
        details
      };
    }

    // æ›´æ–°å¯†é’¥å¼ºåº¦æ˜¾ç¤º
    function updateKeyStrength(key, barId, infoId) {
      const result = checkKeyStrength(key);
      const bar = $('#' + barId);
      const info = $('#' + infoId);
      
      // ç§»é™¤æ‰€æœ‰å¼ºåº¦ç±»
      bar.removeClass('strength-weak strength-medium strength-good strength-strong');
      info.removeClass('strength-info-weak strength-info-medium strength-info-good strength-info-strong');
      
      if (!key) {
        bar.css('width', '0');
        info.hide();
        return;
      }
      
      // æ·»åŠ å¯¹åº”å¼ºåº¦ç±»
      bar.addClass('strength-' + result.strength);
      info.addClass('strength-info-' + result.strength);
      
      // æ›´æ–°ä¿¡æ¯
      let html = `
        <div><strong>${result.message}</strong></div>
        <div class="crack-time">ğŸ’» æš´åŠ›ç ´è§£æ—¶é—´ï¼š${result.timeStr}</div>
        <div>ğŸ“Š å¯†é’¥ç†µå€¼ï¼š${result.entropy} æ¯”ç‰¹</div>
        <div>ğŸ“ å­—ç¬¦ç±»å‹ï¼šé•¿åº¦${result.details.length} | 
          ${result.details.hasLower ? 'âœ“å°å†™' : 'âœ—å°å†™'} | 
          ${result.details.hasUpper ? 'âœ“å¤§å†™' : 'âœ—å¤§å†™'} | 
          ${result.details.hasNumber ? 'âœ“æ•°å­—' : 'âœ—æ•°å­—'} | 
          ${result.details.hasSpecial ? 'âœ“ç‰¹æ®Šç¬¦å·' : 'âœ—ç‰¹æ®Šç¬¦å·'}
        </div>
        <div style="margin-top: 8px;">ğŸ’¡ ${result.recommendation}</div>
      `;
      
      info.html(html).show();
    }

    // AES-256 åŠ å¯† (ä½¿ç”¨CBCæ¨¡å¼ + PBKDF2å¯†é’¥æ´¾ç”Ÿ)
    function aes256Encrypt(text, key) {
      if (!key || key.length < 8) {
        throw new Error('å¯†é’¥é•¿åº¦è‡³å°‘éœ€è¦8ä½å­—ç¬¦');
      }
      // ç”Ÿæˆéšæœºç›å’ŒIV
      const salt = CryptoJS.lib.WordArray.random(128/8);
      const iv = CryptoJS.lib.WordArray.random(128/8);
      
      // ä½¿ç”¨PBKDF2ä»å¯†é’¥æ´¾ç”Ÿ256ä½åŠ å¯†å¯†é’¥
      const derivedKey = CryptoJS.PBKDF2(key, salt, {
        keySize: 256/32,
        iterations: 10000
      });
      
      const encrypted = CryptoJS.AES.encrypt(text, derivedKey, {
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
      });
      
      // å°†salt + iv + ciphertextç»„åˆè¿”å›
      const result = salt.toString() + iv.toString() + encrypted.toString();
      return result;
    }

    function aes256Decrypt(ciphertext, key) {
      if (!key) throw new Error('è¯·è¾“å…¥å¯†é’¥');
      try {
        // æå–salt (32å­—ç¬¦), iv (32å­—ç¬¦), å’Œå¯†æ–‡
        const salt = CryptoJS.enc.Hex.parse(ciphertext.substr(0, 32));
        const iv = CryptoJS.enc.Hex.parse(ciphertext.substr(32, 32));
        const encrypted = ciphertext.substring(64);
        
        // ä½¿ç”¨ç›¸åŒå‚æ•°æ´¾ç”Ÿå¯†é’¥
        const derivedKey = CryptoJS.PBKDF2(key, salt, {
          keySize: 256/32,
          iterations: 10000
        });
        
        const decrypted = CryptoJS.AES.decrypt(encrypted, derivedKey, {
          iv: iv,
          mode: CryptoJS.mode.CBC,
          padding: CryptoJS.pad.Pkcs7
        });
        
        const text = decrypted.toString(CryptoJS.enc.Utf8);
        if (!text) throw new Error('è§£å¯†å¤±è´¥');
        return text;
      } catch (e) {
        throw new Error('è§£å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®');
      }
    }

    // AES-192 åŠ å¯†
    function aes192Encrypt(text, key) {
      if (!key || key.length < 8) {
        throw new Error('å¯†é’¥é•¿åº¦è‡³å°‘éœ€è¦8ä½å­—ç¬¦');
      }
      const encrypted = CryptoJS.AES.encrypt(text, key, {
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
      });
      return encrypted.toString();
    }

    function aes192Decrypt(ciphertext, key) {
      if (!key) throw new Error('è¯·è¾“å…¥å¯†é’¥');
      try {
        const decrypted = CryptoJS.AES.decrypt(ciphertext, key, {
          mode: CryptoJS.mode.CBC,
          padding: CryptoJS.pad.Pkcs7
        });
        const text = decrypted.toString(CryptoJS.enc.Utf8);
        if (!text) throw new Error('è§£å¯†å¤±è´¥');
        return text;
      } catch (e) {
        throw new Error('è§£å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®');
      }
    }

    // AES-128 åŠ å¯†
    function aes128Encrypt(text, key) {
      if (!key || key.length < 8) {
        throw new Error('å¯†é’¥é•¿åº¦è‡³å°‘éœ€è¦8ä½å­—ç¬¦');
      }
      const encrypted = CryptoJS.AES.encrypt(text, key, {
        mode: CryptoJS.mode.CTR,
        padding: CryptoJS.pad.NoPadding
      });
      return encrypted.toString();
    }

    function aes128Decrypt(ciphertext, key) {
      if (!key) throw new Error('è¯·è¾“å…¥å¯†é’¥');
      try {
        const decrypted = CryptoJS.AES.decrypt(ciphertext, key, {
          mode: CryptoJS.mode.CTR,
          padding: CryptoJS.pad.NoPadding
        });
        const text = decrypted.toString(CryptoJS.enc.Utf8);
        if (!text) throw new Error('è§£å¯†å¤±è´¥');
        return text;
      } catch (e) {
        throw new Error('è§£å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®');
      }
    }

    // æ›´æ–°UI
    function updateAlgorithmInfo() {
      const algo = $('#algorithm').val();
      const info = algoInfo[algo];
      $('#algoTitle').text(info.title);
      $('#algoDescription').text(info.description);
    }

    // æ–‡æœ¬åŠ å¯†
    $('#encryptBtn').on('click', function() {
      try {
        const text = $('#inputText').val();
        if (!text) {
          alert('è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬');
          return;
        }

        const algo = $('#algorithm').val();
        const key = $('#secretKey').val();
        
        if (!key) {
          alert('è¯·è¾“å…¥å¯†é’¥');
          return;
        }

        let result = '';
        switch (algo) {
          case 'aes-256':
            result = aes256Encrypt(text, key);
            break;
          case 'aes-192':
            result = aes192Encrypt(text, key);
            break;
          case 'aes-128':
            result = aes128Encrypt(text, key);
            break;
        }

        $('#resultText').text(result);
        $('#resultSection').fadeIn();
      } catch (error) {
        alert('åŠ å¯†å¤±è´¥ï¼š' + error.message);
      }
    });

    // æ–‡æœ¬è§£å¯†
    $('#decryptBtn').on('click', function() {
      try {
        const text = $('#inputText').val();
        if (!text) {
          alert('è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬');
          return;
        }

        const algo = $('#algorithm').val();
        const key = $('#secretKey').val();
        
        if (!key) {
          alert('è¯·è¾“å…¥å¯†é’¥');
          return;
        }

        let result = '';
        switch (algo) {
          case 'aes-256':
            result = aes256Decrypt(text, key);
            break;
          case 'aes-192':
            result = aes192Decrypt(text, key);
            break;
          case 'aes-128':
            result = aes128Decrypt(text, key);
            break;
        }

        $('#resultText').text(result);
        $('#resultSection').fadeIn();
      } catch (error) {
        alert('è§£å¯†å¤±è´¥ï¼š' + error.message);
      }
    });

    // å¤åˆ¶ç»“æœ
    $('#copyBtn').on('click', function() {
      const result = $('#resultText').text();
      if (!result) {
        alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
        return;
      }

      navigator.clipboard.writeText(result).then(function() {
        const originalText = $('#copyBtn').text();
        $('#copyBtn').text('âœ… å·²å¤åˆ¶ï¼');
        setTimeout(function() {
          $('#copyBtn').text(originalText);
        }, 2000);
      }).catch(function() {
        const textarea = document.createElement('textarea');
        textarea.value = result;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      });
    });

    // æ¸…ç©ºæ–‡æœ¬
    $('#clearBtn').on('click', function() {
      $('#inputText').val('');
      $('#resultText').text('');
      $('#resultSection').fadeOut();
      $('#secretKey').val('');
    });

    // æ–‡ä»¶ä¸Šä¼ å¤„ç†
    $('#fileUploadArea').on('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      $('#fileInput').trigger('click');
    });

    $('#fileInput').on('change', function(e) {
      handleFileSelect(e.target.files[0]);
    });

    // æ‹–æ‹½ä¸Šä¼ 
    const fileUploadArea = document.getElementById('fileUploadArea');
    
    fileUploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      $(this).addClass('drag-over');
    });

    fileUploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      $(this).removeClass('drag-over');
    });

    fileUploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      $(this).removeClass('drag-over');
      const file = e.dataTransfer.files[0];
      handleFileSelect(file);
    });

    function handleFileSelect(file) {
      if (!file) return;

      const validTypes = ['.md', '.txt', '.encrypted'];
      const fileName = file.name.toLowerCase();
      const isValid = validTypes.some(type => fileName.endsWith(type));

      if (!isValid) {
        alert('åªæ”¯æŒ .mdã€.txt å’Œ .encrypted æ–‡ä»¶ï¼');
        return;
      }

      currentFile = file;
      const reader = new FileReader();
      
      reader.onload = function(e) {
        currentFileContent = e.target.result;
        $('#fileDetails').html(`
          <p><strong>æ–‡ä»¶å:</strong> ${file.name}</p>
          <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
          <p><strong>æ–‡ä»¶ç±»å‹:</strong> ${file.type || 'text/plain'}</p>
        `);
        $('#fileInfo').fadeIn();
      };

      reader.readAsText(file);
    }

    // åŠ å¯†æ–‡ä»¶
    $('#encryptFileBtn').on('click', function() {
      try {
        if (!currentFile || !currentFileContent) {
          alert('è¯·å…ˆé€‰æ‹©è¦åŠ å¯†çš„æ–‡ä»¶');
          return;
        }

        const key = $('#fileSecretKey').val();
        if (!key) {
          alert('è¯·è¾“å…¥å¯†é’¥');
          return;
        }

        const algo = $('#fileAlgorithm').val();
        let encrypted = '';

        switch (algo) {
          case 'aes-256':
            encrypted = aes256Encrypt(currentFileContent, key);
            break;
          case 'aes-192':
            encrypted = aes192Encrypt(currentFileContent, key);
            break;
          case 'aes-128':
            encrypted = aes128Encrypt(currentFileContent, key);
            break;
        }

        // ä¸‹è½½åŠ å¯†æ–‡ä»¶
        const blob = new Blob([encrypted], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = currentFile.name + '.encrypted';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('æ–‡ä»¶åŠ å¯†æˆåŠŸï¼å·²ä¸‹è½½åŠ å¯†æ–‡ä»¶');
      } catch (error) {
        alert('åŠ å¯†å¤±è´¥ï¼š' + error.message);
      }
    });

    // è§£å¯†æ–‡ä»¶
    $('#decryptFileBtn').on('click', function() {
      try {
        if (!currentFile || !currentFileContent) {
          alert('è¯·å…ˆé€‰æ‹©è¦è§£å¯†çš„æ–‡ä»¶');
          return;
        }

        const key = $('#fileSecretKey').val();
        if (!key) {
          alert('è¯·è¾“å…¥å¯†é’¥');
          return;
        }

        const algo = $('#fileAlgorithm').val();
        let decrypted = '';

        switch (algo) {
          case 'aes-256':
            decrypted = aes256Decrypt(currentFileContent, key);
            break;
          case 'aes-192':
            decrypted = aes192Decrypt(currentFileContent, key);
            break;
          case 'aes-128':
            decrypted = aes128Decrypt(currentFileContent, key);
            break;
        }

        // ä¸‹è½½è§£å¯†æ–‡ä»¶
        const blob = new Blob([decrypted], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        
        // ç§»é™¤ .encrypted åç¼€
        let fileName = currentFile.name;
        if (fileName.endsWith('.encrypted')) {
          fileName = fileName.slice(0, -10);
        } else {
          fileName = fileName + '.decrypted';
        }
        
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('æ–‡ä»¶è§£å¯†æˆåŠŸï¼å·²ä¸‹è½½è§£å¯†æ–‡ä»¶');
      } catch (error) {
        alert('è§£å¯†å¤±è´¥ï¼š' + error.message);
      }
    });

    // æ¸…ç©ºæ–‡ä»¶
    $('#clearFileBtn').on('click', function() {
      currentFile = null;
      currentFileContent = null;
      $('#fileInput').val('');
      $('#fileInfo').fadeOut();
      $('#fileSecretKey').val('');
    });

    // ç®—æ³•åˆ‡æ¢
    $('#algorithm').on('change', updateAlgorithmInfo);

    // å¯†é’¥å¼ºåº¦å®æ—¶æ£€æµ‹
    $('#secretKey').on('input', function() {
      updateKeyStrength($(this).val(), 'keyStrengthBar', 'keyStrengthInfo');
    });

    $('#fileSecretKey').on('input', function() {
      updateKeyStrength($(this).val(), 'fileKeyStrengthBar', 'fileKeyStrengthInfo');
    });

    // åˆå§‹åŒ–
    updateAlgorithmInfo();
  </script>
</body>

</html>
